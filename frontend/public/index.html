<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="ä¸€ä¸ªæä¾›arXivæœ€æ–°å­¦æœ¯è®ºæ–‡å¹¶åŸºäºå…³é”®è¯åŒ¹é…è¿›è¡Œæ¨é€çš„ç½‘ç«™"
    />
    <!-- å…è®¸ä½¿ç”¨è·¨æºéš”ç¦» -->
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin" />
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp" />
    
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>arXivæ–‡çŒ®æ¨é€ç³»ç»Ÿ</title>
    <script>
      // é˜²æ­¢ZOTERO_CONFIGé‡å¤å£°æ˜é”™è¯¯
      if (typeof ZOTERO_CONFIG === 'undefined') {
        var ZOTERO_CONFIG = null;
      }
      
      // æ·»åŠ å…¨å±€ä»£ç†åˆ‡æ¢å‡½æ•°ï¼Œå¯èƒ½åœ¨ç½‘ç»œé”™è¯¯æ—¶ä½¿ç”¨
      window.ARXIV_PUSHER_CONFIG = {
        corsProxies: [
          'https://api.codetabs.com/v1/proxy?quest=',
          'https://corsproxy.io/?',
          'https://proxy.cors.sh/',
          'https://cors-proxy.htmldriven.com/?url='
        ],
        currentProxyIndex: 0
      };
      
      // å…¨å±€CORSé”™è¯¯å¤„ç†å‡½æ•°
      window.handleCorsError = function(url) {
        console.warn('CORSé”™è¯¯ï¼Œå°è¯•åˆ‡æ¢ä»£ç†: ' + url);
        window.ARXIV_PUSHER_CONFIG.currentProxyIndex = 
          (window.ARXIV_PUSHER_CONFIG.currentProxyIndex + 1) % 
          window.ARXIV_PUSHER_CONFIG.corsProxies.length;
        
        return window.ARXIV_PUSHER_CONFIG.corsProxies[window.ARXIV_PUSHER_CONFIG.currentProxyIndex] + 
          encodeURIComponent(url);
      };
    </script>
    <!-- åŠ è½½EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
      // ç¡®ä¿EmailJS SDKæ­£ç¡®åŠ è½½
      document.addEventListener('DOMContentLoaded', function() {
        console.log('EmailJS SDK loaded:', typeof emailjs !== 'undefined');
        
        // æ·»åŠ è°ƒè¯•ä¿¡æ¯å˜é‡ï¼Œå¸®åŠ©æ’æŸ¥æ¨¡æ¿é—®é¢˜
        window.EMAIL_DEBUG = {
          lastError: null,
          lastParams: null
        };
        
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦æœ‰EmailJSé…ç½®
        try {
          const emailSettings = localStorage.getItem('email_settings');
          if (emailSettings) {
            const settings = JSON.parse(emailSettings);
            if (settings && settings.emailjsId) {
              console.log('Found EmailJS settings, initializing with public key');
              // æ·»åŠ æ˜¾å¼try/catchä»¥ä¾¿æ›´æ¸…æ™°åœ°æ˜¾ç¤ºåˆå§‹åŒ–é”™è¯¯
              try {
                emailjs.init(settings.emailjsId);
                
                // ä¸ºemailjs.sendæ–¹æ³•æ·»åŠ æ‹¦æˆªå™¨ï¼Œè®°å½•å‘é€å‚æ•°å’Œé”™è¯¯
                const originalSend = emailjs.send;
                emailjs.send = function(serviceId, templateId, params, publicKey) {
                  console.log('EmailJS send intercepted:', {
                    serviceId,
                    templateId,
                    params,
                    publicKeyLength: publicKey ? publicKey.length : 0
                  });
                  
                  // å­˜å‚¨å‚æ•°ç”¨äºè°ƒè¯•
                  window.EMAIL_DEBUG.lastParams = {
                    serviceId,
                    templateId,
                    params,
                    time: new Date().toISOString()
                  };
                  
                  return originalSend.call(this, serviceId, templateId, params, publicKey)
                    .catch(error => {
                      // è®°å½•é”™è¯¯
                      window.EMAIL_DEBUG.lastError = {
                        error: error,
                        params: params,
                        time: new Date().toISOString()
                      };
                      throw error;
                    });
                };
              } catch (initErr) {
                console.error('EmailJS initialization failed:', initErr);
              }
            }
          }
        } catch (e) {
          console.error('Error initializing EmailJS:', e);
        }
      });
    </script>
    <!-- æµ‹è¯•æ¨¡æ¿å˜é‡è¾…åŠ©è„šæœ¬ -->
    <script>
      // æä¾›æµ‹è¯•å˜é‡çš„è¾…åŠ©å‡½æ•°
      window.testEmailjsTemplate = function(serviceId, templateId, publicKey) {
        if (!window.emailjs) {
          return console.error('EmailJS not loaded');
        }
        
        try {
          // ä½¿ç”¨æ‰€æœ‰å¯èƒ½çš„å˜é‡ååˆ›å»ºæµ‹è¯•å‚æ•°
          const testParams = {
            to_email: "test@example.com",
            recipient: "test@example.com", 
            user_email: "test@example.com",
            to_name: "Test User",
            from_name: "Test Sender",
            subject: "Test Subject",
            message: "Test Message",
            papers: "<p>Test Paper Content</p>",
            content: "<p>Test Content</p>"
          };
          
          console.log('Testing EmailJS template:', {serviceId, templateId});
          emailjs.send(serviceId, templateId, testParams, publicKey)
            .then(function(res) {
              console.log('Template test success:', res);
            })
            .catch(function(err) {
              console.error('Template test error:', err);
              // åˆ†æé”™è¯¯æç¤ºå¯èƒ½çš„å˜é‡é—®é¢˜
              if (err.text && err.text.includes('recipient')) {
                console.warn('ğŸ’¡ æç¤º: æ¨¡æ¿å¯èƒ½éœ€è¦åœ¨To Emailå­—æ®µä½¿ç”¨{{to_email}}å˜é‡');
              }
            });
        } catch (e) {
          console.error('Error testing template:', e);
        }
      };
    </script>
  </head>
  <body>
    <noscript>æ‚¨éœ€è¦å¯ç”¨JavaScriptæ‰èƒ½è¿è¡Œæ­¤åº”ç”¨ã€‚</noscript>
    <div id="root"></div>
  </body>
</html> 